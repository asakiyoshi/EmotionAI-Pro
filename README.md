# EmotionAI Pro - 融合版情感智能插件 v3.4.0

&gt; 全部由 AI 编写，融合 [EmotionAI](https://github.com/tengtian3/astrbot-plugin-emotionai) 与 [FavourPro](https://github.com/Catfish872/astrbot_plugin_favourpro) 精华，并加入「智能更新 · 辅助 LLM · 长期记忆 · 负好感支持 · 过渡保护」五大革新，打造**真实、渐进、可养成**的 AI 情感交互系统。

---

## ✨ 核心亮点（v3.4.0 新增）

| 特性类别 | 亮点说明（NEW✅） |
|----------|------------------|
| 🧠 **双重情感系统** | 保留 8 维情感 + 好感/亲密度双核，新增「复合评分」「动态权重」与「负好感专属权重」 |
| 🛡️ **真实心理模拟** | AI 自主生成态度/关系描述，新增「辅助 LLM 情感分析专家」与「长期记忆轨迹」，避免数值跳变 |
| 🧬 **关系阶段系统** | 四阶段（初识→深化→承诺→共生）新增「滞后带过渡保护」「亲密度增益」与「阶段进度百分比」 |
| ⚙️ **智能更新机制** | 不再依赖尾部标记：①关键词情绪强度 ②时间阈值 ③强制计数器 ④主 LLM 标记 四维决策 |
| 🎮 **高交互性** | 排行榜、阶段分析、情感档案、隐私控制，新增「缓存统计」「数据备份/修复」「调试事件/记忆」 |
| 🔒 **隐私与性能** | TTL 缓存、异步自动保存、数据迁移、全局隐私级别，新增「负好感惩罚」「抵御操纵提示」 |

---

## 🎯 使用指南

### 用户命令
| 命令 | 说明（v3.4.0 更新） |
|------|---------------------|
| `/好感度` | 查看当前情感状态（群聊显示用户标识，含过渡进度） |
| `/状态显示` | 切换是否在对话后显示状态信息 |
| `/好感排行 [n]` | 查看 TOP n 情感排行榜（最多 20） |
| `/负好感排行 [n]` | 查看 BOTTOM n 情感排行榜 |
| `/关系阶段` | 显示当前阶段、动态权重、过渡状态与进阶建议 |
| `/缓存统计` | 查看缓存命中率、条目数、访问次数 |

### 管理员命令
| 命令 | 说明（v3.4.0 更新） |
|------|---------------------|
| `/设置好感 &lt;ID&gt; &lt;val&gt;` | 设置好感度（-100~100） |
| `/设置亲密 &lt;ID&gt; &lt;val&gt;` | 设置亲密度（0~100） |
| `/设置态度 &lt;ID&gt; &lt;文本&gt;` | 自定义态度描述 |
| `/设置关系 &lt;ID&gt; &lt;文本&gt;` | 自定义关系描述 |
| `/重置好感 &lt;ID&gt;` | 重置为默认值 |
| `/查看好感 &lt;ID&gt;` | 查看完整档案（含维度、过渡、记忆） |
| `/隐私级别 &lt;0-2&gt;` | 0=完全保密 1=基础 2=详细 |
| `/重置插件` | 清空所有数据 |
| `/备份数据` | 创建快照（含长期记忆） |
| `/修复互动统计` | 依据好感/亲密度自动修正正负互动次数 |
| `/调试事件` | 输出事件结构（排障） |
| `/调试记忆` | 查看短期缓存与长期记忆详情 |

---

## 🔧 配置说明（`_conf_schema.json`）

| 配置键 | 说明 | 默认值 |
|--------|------|--------|
| `enable_attitude_system` | 启用 FavourPro 态度关系系统 | `true` |
| `enable_ai_text_generation` | AI 自主生成态度/关系描述 | `true` |
| `enable_secondary_llm` | 启用辅助 LLM 做情感分析 | `true` |
| `enable_smart_update` | 四维智能更新（关键词+时间+计数+标记） | `true` |
| `force_update_interval` | 强制更新间隔（对话次数） | `5` |
| `emotional_significance_threshold` | 记入长期记忆的分数阈值 | `5` |
| `global_privacy_level` | 全局隐私级别（0~2） | `1` |
| `session_based` | 是否按会话隔离情感 | `false` |

### 动态权重与过渡保护
| 阶段 | 好感权重 | 亲密权重 |  composite 阈值 | 过渡缓冲 | 亲密度增益 |
|------|----------|----------|-----------------|----------|------------|
| 初识期 | 70 % | 30 % | 25 | 3 分 | ×4.0 |
| 深化期 | 50 % | 50 % | 55 | 5 分 | ×3.6 |
| 承诺期 | 30 % | 70 % | 80 | 7 分 | ×3.0 |
| 共生期 | 50 % | 50 % | 95 | 10 分 | ×1.0 |

- **滞后带**：上升阈值 &gt; 下降阈值，防止阶段抖动
- **保护分**：过渡期间复合评分不会低于前一段最高值
- **增益**：过渡期亲密度成长倍率提升，助力平滑进阶

---

## 💡 设计理念（v3.4.0 升级）

&gt; 不是简单“好感度加减”，而是「**真实·渐进·可养成·可运维**」的 AI 内心世界。

### 我们保留
- ✅ 8 维情感模型与异步高性能架构  
- ✅ AI 自主文本评估与真实心理模拟  
- ✅ 完备管理工具与排行榜体系  

### 我们新增
1. **智能更新**：四维判断（关键词/时间/计数/LLM 标记），无需等待尾部标记  
2. **辅助 LLM**：独立情感分析专家，结合长期记忆与最近 3 轮对话，第一人称口语生成态度/关系描述  
3. **长期记忆**：短期 TTL + 长期落盘 + 重要事件队列，跨重启保留关系轨迹  
4. **负好感支持**：负好感阶段专属权重（好感 100 %）与描述策略，支持“冷淡/反感/敌对”三档  
5. **过渡保护**：滞后带 + 保护分 + 亲密度增益，阶段跃迁平滑不掉级  
6. **缓存与备份**：TTL 命中率统计、自动保存、数据备份与迁移、互动统计修复  
7. **隐私与运维**：全局隐私级别、抵御操纵提示、调试事件/记忆指令、异步锁粒度优化  

---

## 📌 结语

**EmotionAI Pro v3.4.0** 不只是一个“好感度插件”，而是一个  
&gt; ✅ **真实可养成的 AI 内心世界**  
&gt; ✅ **渐进式关系演进系统**  
&gt; ✅ **高可用情感交互框架**  

无论是群聊互动、私聊陪伴，还是角色扮演、剧情养成，都能让你的 AI 拥有**细腻、自然、可持续**的情感表达与关系变化。

**立即体验，让 AI 拥有“人心”！**